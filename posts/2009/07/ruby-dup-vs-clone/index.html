
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruby dup vs clone - Arnab's Universe</title>
  <meta name="author" content="Arnab Deka">

  
  <meta name="description" content="I have had this question about the difference between Ruby’s clone and dup method multiple times now. And I have always had this fuzzy feeling that “ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://arnab.github.com/posts/2009/07/ruby-dup-vs-clone/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Arnab's Universe" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37747278-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Arnab's Universe</a></h1>
  
    <h2>... and all the parallel ones.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:arnab.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Ruby Dup vs Clone</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-28T00:00:00+05:30" pubdate data-updated="true">Jul 28<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I have had this question about the difference between Ruby’s <code>clone</code> and <code>dup</code> method multiple times now. And I have always had this fuzzy feeling that “they are almost the same thing”. Today my colleague asked it again and I decided to dig it out. Here’s what <a href="http://ruby-doc.org/core/classes/Object.html">Ruby API docs</a> say about them:</p>

<blockquote><p><strong>Object#clone</strong>
Produces a shallow copy of obj—the instance variables of obj are copied, but not the objects they reference. Copies the frozen and tainted state of obj.</p>

<p><strong>Object#dup</strong>
Produces a shallow copy of obj—the instance variables of obj are copied, but not the objects they reference. dup copies the tainted state of obj. See also the discussion under Object#clone. In general, clone and dup may have different semantics in descendant classes. While clone is used to duplicate an object, including its internal state, dup typically uses the class of the descendant object to create the new instance.</p>

<p>This method may have class-specific behavior. If so, that behavior will be documented under the #initialize_copy method of the class.</p></blockquote>

<p>So in essence, both produce shallow-copies of the object. clone copies the frozen <em>and</em> tainted state while dup copies only the tainted state. Even after reading that documentation twice, it’s still murky in my head (probably coz I have not had <em>a chance</em> to write code to notice the frozen or tainted state specifically.)</p>

<p>Here’s a gem from ruby-talk that Google brought up: <a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/6328">http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/6328</a>. So Matz says:</p>

<blockquote><p><code>clone’ copies everything; internal state, singleton methods, etc.
</code>dup’ copies object contents only (plus taintness status).</p></blockquote>

<p>And so I wrote a bit of code to see it myself (and thus remember it). Here’s a very simple Person class:</p>

<pre><code>class Person
  attr_accessor :name
end
</code></pre>

<p>Now we instantiate a Person object (p) and add then an singleton method on the new object (p) to say hi:</p>

<pre><code>p = Person.new
p.name = "The Man"

# now add a singleton method on p:
def p.say_hi
  "&amp;#039;sup"
end
</code></pre>

<p>See that it’s all working:</p>

<pre><code>irb(main):014:0&gt; puts p.inspect
#&lt;person :0xb7e83340 @name="The Man"&gt;
=&gt; nil
irb(main):015:0&gt; puts p.say_hi
&amp;#039;sup
=&gt; nil
</code></pre>

<p>Now create a clone and a dup of it:</p>

<pre><code>the_clone = p.clone
the_dup = p.dup
</code></pre>

<p>Both the clone and the dup have the same instance variables (which are shallow-copies BTW), but only the clone has the singleton method (say_hi) in it:</p>

<pre><code>irb(main):018:0&gt; the_clone.name
=&gt; "The Man"
irb(main):019:0&gt; the_dup.name
=&gt; "The Man"
irb(main):020:0&gt; the_clone.say_hi
=&gt; "&amp;#039;sup"
irb(main):021:0&gt; the_dup.say_hi
NoMethodError: undefined method `say_hi&amp;#039; for
(Person :0xb7e83340 @name="The Man")
        from (irb):21
        from :0
irb(main):022:0&gt;
</code></pre>

<p>So that makes me feel that clone has to do more work than dup does. Hence dup might be more beneficial for performance compared to clone (unless you really need to use clone). Comments are welcome!</person></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Arnab</span></span>

      








  


<time datetime="2009-07-28T00:00:00+05:30" pubdate data-updated="true">Jul 28<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/posts/categories/programming/'>programming</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://arnab.github.com/posts/2009/07/ruby-dup-vs-clone/" data-via="arnab_deka" data-counturl="http://arnab.github.com/posts/2009/07/ruby-dup-vs-clone/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/posts/2009/07/gnu-screen/" title="Previous Post: GNU Screen">&laquo; GNU Screen</a>
      
      
        <a class="basic-alignment right" href="/posts/2009/08/photos-hamilton-park-and-alki-beach/" title="Next Post: Photos: Hamilton Viewpoint Park and Alki Beach, West Seattle">Photos: Hamilton Viewpoint Park and Alki Beach, West Seattle &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    Included file 'asides/about.html' not found in _includes directory<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/posts/2012/09/state-of-e-commerce-in-india/">State of e-commerce in India</a>
      </li>
    
      <li class="post">
        <a href="/posts/2012/09/emacs-change-fonts-dynamically-based-on-screen-resolution/">Emacs: change fonts dynamically based on screen resolution</a>
      </li>
    
      <li class="post">
        <a href="/posts/2012/09/allowing-and-testing-cors-requests-in-rails/">Allowing and testing CORS requests in Rails
</a>
      </li>
    
      <li class="post">
        <a href="/posts/2011/04/quick-howto-accessing-rails-properties/">Quick howto on accessing Rails Properties</a>
      </li>
    
      <li class="post">
        <a href="/posts/2010/12/notes-on-emacs-cl-clojure-slime/">Notes on Emacs + CL + Clojure + Slime...</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/arnab">@arnab</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'arnab',
            count: 3,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("arnab_deka", 3, true);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/arnab_deka" class="twitter-follow-button" data-show-count="true">Follow @arnab_deka</a>
  
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/arnab.deka?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/arnab.deka">My Delicious Bookmarks &raquo;</a></p>
</section>

<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/101426291592553950447?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Arnab Deka -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
