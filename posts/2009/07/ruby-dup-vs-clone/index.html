
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruby dup vs clone - Arnab's Universe</title>
  <meta name="author" content="Arnab Deka">

  
<<<<<<< HEAD
  <meta name="description" content="Tweet Ruby Dup vs Clone Tuesday, July the 28th, 2009 | Comments This was written way before StackOverflow launched, and
certainly much before it &hellip;">
=======
  <meta name="description" content="This was written way before StackOverflow launched, and
certainly much before it became popular. Those were the days when
programmers had find out &hellip;">
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://arnab-deka.com/posts/2009/07/ruby-dup-vs-clone">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Arnab's Universe" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-7241491-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<<<<<<< HEAD
<body >
  <header role="banner" id="sidebar">
    <!-- Logo -->
<aside id="logo" class="clearfix">
  <div class="clearfix">
    <a href="/">Arnab's Universe</a>
  </div>
</aside>

<ul id="menu">

  <li class="title">
    <h1 id="title"><a href="/">Arnab's Universe</a></h1>
  </li>


  <li class="subtitle">
    <h2 id="subtitle">... and all the parallel ones.</h2>
  </li>

  <li class="link">
    <a href="/about/">about</a>
  </li>
  <li class="resume">
    <a href="/resume/">resume</a>
  </li>

  <li class="link">
    <a href="http://twitter.com/arnab_deka/">twitter</a>
  </li>


  <li class="link">
    <a href="http://github.com/arnab/">github</a>
  </li>

  <li class="link">
    <a href="http://www.linkedin.com/in/arnab1981">linkedin</a>
  </li>

  <li class="link">
    <a href="/blog/archives">archives</a>
  </li>

  <li class="link rss">
    <a href="/atom.xml">rss feed</a>
  </li>

</ul>


=======
<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Arnab's Universe</a></h1>
  
    <h2>... and all the parallel ones.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:arnab-deka.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<<<<<<< HEAD


<!-- Octopress Love -->
<aside id="octopress_linkback">
  <a href="http://octopress.org/">
    <span class="unicode_square">
      <span class="unicode_circle">
        &nbsp;
      </span>
    </span>
    <span class="octopress">Powered by Octopress</span>
  </a>
</aside>

  </header>
  <section id="main">
    <article class="post">
  <div class="sharing-box">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://arnab-deka.com/posts/2009/07/ruby-dup-vs-clone/" data-via="arnab_deka" data-counturl="http://arnab-deka.com/posts/2009/07/ruby-dup-vs-clone/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
  <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

  
  <header>
    
      <h2 class="entry-title">Ruby Dup vs Clone</h2>
=======
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/resume">Resume</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Ruby Dup vs Clone</h1>
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
    
    
      <p class="meta">
        








  


<time datetime="2009-07-28T00:00:00+05:30" pubdate data-updated="true">Tuesday, July the 28<span>th</span>, 2009</time>
        
<<<<<<< HEAD
         | <a href="#disqus_thread">Comments</a>
=======
           | <a href="#disqus_thread"
             data-disqus-identifier="http://arnab-deka.com">Comments</a>
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
        
      </p>
    
  </header>


<<<<<<< HEAD
<blockquote><p>This was written way before <a href="http://www.joelonsoftware.com/items/2008/09/15.html">StackOverflow launched</a>, and
=======
<div class="entry-content"><blockquote><p>This was written way before <a href="http://www.joelonsoftware.com/items/2008/09/15.html">StackOverflow launched</a>, and
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
certainly much before it became popular. Those were the days when
programmers had find out answers themselves ;)
This has since been <a href="http://stackoverflow.com/q/10183370/117750">asked and answered</a> on StackOverflow.</p></blockquote>

<p>I have had this question about the difference between Ruby&rsquo;s <code>clone</code>
and <code>dup</code> method multiple times now. And I have always had this fuzzy
feeling that &ldquo;they are almost the same thing&rdquo;. Today my colleague
asked it again and I decided to dig it out. Here&rsquo;s what
<a href="http://www.joelonsoftware.com/items/2008/09/15.html">Ruby API docs</a> say about them:</p>

<h3><code>Object#clone</code></h3>

<blockquote><p>Produces a shallow copy of obj &ndash; the instance variables of obj are
copied, but not the objects they reference. Copies the frozen and
tainted state of obj.</p></blockquote>

<h3><code>Object#dup</code></h3>

<blockquote><p>Produces a shallow copy of objâ€”the instance variables of obj are
copied, but not the objects they reference. dup copies the tainted
state of obj. See also the discussion under Object#clone. In general,
clone and dup may have different semantics in descendant classes.
While clone is used to duplicate an object, including its internal
state, dup typically uses the class of the descendant object to create
the new instance.</p>

<p>This method may have class-specific behavior. If so, that behavior
will be documented under the #initialize_copy method of the class.</p></blockquote>

<p>So in essence, both produce shallow-copies of the object. <code>clone</code>
copies the frozen <strong>and</strong> tainted state while <code>dup</code> copies only the
tainted state. Even after reading that documentation twice, it&rsquo;s still
murky in my head (probably coz I have not had <em>a chance</em> to write code
to notice the frozen or tainted state specifically.)</p>

<p>Here&rsquo;s a gem from ruby-talk that Google brought up. So
<a href="3">Matz says</a>:</p>

<blockquote><p><code>clone</code> copies everything; internal state, singleton methods, etc.
<code>dup</code> copies object contents only (plus taintness status).</p></blockquote>

<p>And so I wrote a bit of code to see it myself (and thus remember it).
Here&rsquo;s a very simple <code>Person</code> class:</p>

<<<<<<< HEAD
<div><script src='https://gist.github.com/4585462.js?file=person.rb'></script>
=======
<div><script src='https://gist.github.com/arnab/4585462/raw/person.rb'></script>
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
<noscript><pre><code>class Person
  attr_accessor :name
end
</code></pre></noscript></div>


<p>Now we instantiate a <code>Person</code>, <code>p</code> and add a singleton method to it to say hi:</p>

<<<<<<< HEAD
<div><script src='https://gist.github.com/4585462.js?file=person_say_hi.rb'></script>
=======
<div><script src='https://gist.github.com/arnab/4585462/raw/person_say_hi.rb'></script>
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
<noscript><pre><code>p = Person.new
p.name = &quot;The Man&quot;

# now add a singleton method on p:
def p.say_hi
<<<<<<< HEAD
  &quot;'sup&quot;
=======
  &quot;&#39;sup&quot;
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
end
</code></pre></noscript></div>


<p>See that it&rsquo;s all working:</p>

<<<<<<< HEAD
<div><script src='https://gist.github.com/4585462.js?file=validate.rb'></script>
=======
<div><script src='https://gist.github.com/arnab/4585462/raw/validate.rb'></script>
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
<noscript><pre><code>irb(main):014:0&gt; puts p.inspect
#&lt;person :0xb7e83340 @name=&quot;The Man&quot;&gt;
=&gt; nil
irb(main):015:0&gt; puts p.say_hi
<<<<<<< HEAD
'sup
=======
&#39;sup
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
=&gt; nil
</code></pre></noscript></div>


<p>Now create a clone and a dup of it:</p>

<<<<<<< HEAD
<div><script src='https://gist.github.com/4585462.js?file=clone_and_dup.rb'></script>
=======
<div><script src='https://gist.github.com/arnab/4585462/raw/clone_and_dup.rb'></script>
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
<noscript><pre><code>the_clone = p.clone
the_dup = p.dup
</code></pre></noscript></div>


<p>Both the clone and the dup have the same instance variables (which are
shallow-copies BTW), but only the clone has the singleton method
(<code>#say_hi</code>) in it:</p>

<<<<<<< HEAD
<div><script src='https://gist.github.com/4585462.js?file=dup_vs_clone.rb'></script>
=======
<div><script src='https://gist.github.com/arnab/4585462/raw/dup_vs_clone.rb'></script>
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
<noscript><pre><code>irb(main):018:0&gt; the_clone.name
=&gt; &quot;The Man&quot;
irb(main):019:0&gt; the_dup.name
=&gt; &quot;The Man&quot;
irb(main):020:0&gt; the_clone.say_hi
<<<<<<< HEAD
=&gt; &quot;'sup&quot;
irb(main):021:0&gt; the_dup.say_hi
NoMethodError: undefined method `say_hi' for 
=======
=&gt; &quot;&#39;sup&quot;
irb(main):021:0&gt; the_dup.say_hi
NoMethodError: undefined method `say_hi&#39; for 
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
(Person :0xb7e83340 @name=&quot;The Man&quot;)
        from (irb):21
        from :0
irb(main):022:0&gt; 
</code></pre></noscript></div>


<p>So that makes me feel that <code>#clone</code> has to do more work than <code>#dup</code>
does. Hence <code>#dup</code> might be more beneficial for performance compared to
<code>#clone</code> (unless you really need to use clone). Comments are welcome!</p>
<<<<<<< HEAD



</article>


    <nav role="navigation" id="pagination">

</nav>
  </section>
  

=======
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Arnab</span></span>

      








  


<time datetime="2009-07-28T00:00:00+05:30" pubdate data-updated="true">Tuesday, July the 28<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/posts/categories/programming/'>programming</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://arnab-deka.com/posts/2009/07/ruby-dup-vs-clone/" data-via="arnab_deka" data-counturl="http://arnab-deka.com/posts/2009/07/ruby-dup-vs-clone/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/posts/2009/07/gnu-screen/" title="Previous Post: GNU Screen">&laquo; GNU Screen</a>
      
      
        <a class="basic-alignment right" href="/posts/2009/08/photos-hamilton-park-and-alki-beach/" title="Next Post: Photos: Hamilton Viewpoint Park and Alki Beach, West Seattle">Photos: Hamilton Viewpoint Park and Alki Beach, West Seattle &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>I am a Software Developer and a regular guy-next-door, passionate
  about technology. Currently a Senior Engineer at LivingSocial and
  previously at Amazon and AWS. <a href="/about">more...</a>
  </p>
</section>
<section>
  <h1>
    <a href="https://coderwall.com/coderdude"><img alt="Endorse me on Coderwall"
                                                   src="http://api.coderwall.com/coderdude/endorsecount.png"/></a>
  </h1>
</section>
<section>
  <h1>
    <a href="http://in.linkedin.com/in/arnab1981"><img src="http://www.linkedin.com/img/webpromo/btn_profile_bluetxt_80x15.png"
          alt="View Arnab Deka's profile on LinkedIn"></a>
  </h1>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/posts/2013/02/debugging-warnings-in-tests/">Debugging Warnings in Tests</a>
      </li>
    
      <li class="post">
        <a href="/posts/2013/02/hello-jquery-prettytextdiff/">Hello jQuery.PrettyTextDiff</a>
      </li>
    
      <li class="post">
        <a href="/posts/2012/09/state-of-e-commerce-in-india/">State of E-commerce in India</a>
      </li>
    
      <li class="post">
        <a href="/posts/2012/09/emacs-change-fonts-dynamically-based-on-screen-resolution/">Emacs: Change Fonts Dynamically Based on Screen Resolution</a>
      </li>
    
      <li class="post">
        <a href="/posts/2012/09/allowing-and-testing-cors-requests-in-rails/">Allowing and Testing CORS Requests in Rails</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/arnab">@arnab</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'arnab',
            count: 3,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("arnab_deka", 3, true);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/arnab_deka" class="twitter-follow-button" data-show-count="true">Follow @arnab_deka</a>
  
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/arnab.deka?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/arnab.deka">My Delicious Bookmarks &raquo;</a></p>
</section>

<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/101426291592553950447?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo">
</footer>
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
  

<script type="text/javascript">
      var disqus_shortname = 'arnabdeka';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
<<<<<<< HEAD
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
=======
      dsq.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + disqus_shortname + '.disqus.com/' + disqus_script;
>>>>>>> Site updated at 2013-10-04 06:03:48 UTC
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
